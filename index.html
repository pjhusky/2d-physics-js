<!DOCTYPE html>
<html>                          
    <head>

        <!-- TODOs:
        * ship could change shape when grabbing power up
            - e.g.  slower but easier to carry things (puzzles that require transporting some fractured fragment to a switch for example!)
                    when in slick/fast shape, some passages/corridors may have falling stones/closing doors that you can't make with the slow/transporter ship shape
        * make boundary-constraints that contain quicksilver particles or soft bodies movable by the player (like an invisible circular rigid body...)
            - we could even keep plane constraints inside the circle-boundary constraints and transform them into the rotated simulation domain
            - a bit like a hamster wheel
        * fix background parallax; somehow it was too small all of a sudden ...
        * make breaking of objects take point of impact into account -->
        
        <!-- during development - make sure browser really refreshes source & assets!!! -->
        <meta http-equiv="Cache-control" content="no-cache, no-store, must-revalidate">
        <meta http-equiv="Pragma" content="no-cache">
                
        <!-- WORK IN PROGESS!!! -->
        <title>Magnetic Scrapyard 1000</title>
        <link rel="icon" type="image/png" href="./assets/magnetic-field-2.png">
        <link rel="shortcut icon" type="image/png" href="./assets/magnetic-field-2.png">

        <!-- ################ Framework(s) ################ -->
        <script type="text/javascript" src="./js/PixiJS/pixi.js"></script>
        <script type="text/javascript" src="./js/PixiJS/pixi-sound.js"></script>

        <!-- ################ Gfx & Effects ################ -->
        <script type="text/javascript" src="./js/filterShaders.js?v=1"></script>
        <script type="text/javascript" src="./js/gauss.js?v=1"></script>
        <script type="text/javascript" src="./js/builtinRenderPrimitive.js?v=1"></script>
        
        <!-- ################ Utils & Settings ################ -->
        <script type="text/javascript" src="./js/appUtils.js?v=1"></script>
        <script type="text/javascript" src="./js/mathUtil.js?v=1"></script>
        <script type="text/javascript" src="./js/gfxUtils.js?v=1"></script>
        <script type="text/javascript" src="./js/vec2.js?v=1"></script>
        <script type="text/javascript" src="./js/mat2x3.js?v=1"></script>
        <script type="text/javascript" src="./js/triangle.js?v=1"></script>
        <script type="text/javascript" src="./js/utils.js?v=1"></script>
        <script type="text/javascript" src="./js/simulationParameters.js?v=1"></script>
        <script type="text/javascript" src="./js/input.js?v=1"></script> <!-- maybe not needed -->
        
        <!-- ################ Techs & Solvers ################ -->
        <script type="text/javascript" src="./js/particleSystemMgr.js?v=1"></script>
        <script type="text/javascript" src="./js/particleFluidSolver.js?v=1"></script>
        <script type="text/javascript" src="./js/particleBoundaryConstraint.js?v=1"></script>
        <!-- <script type="text/javascript" src="./js/springMassSolver.js?v=1"></script> -->
        <script type="text/javascript" src="./js/softBodySolver.js?v=1"></script>
        <script type="text/javascript" src="./js/softBodyObjectMgr.js?v=1"></script>

        <script type="text/javascript" src="./js/shapeType.js?v=1"></script>
        <script type="text/javascript" src="./js/boundingCircle.js?v=1"></script>
        <script type="text/javascript" src="./js/convexHull.js?v=1"></script>
        <script type="text/javascript" src="./js/delaunay.js?v=1"></script>
        <script type="text/javascript" src="./js/voronoi.js?v=1"></script>
        
        <script type="text/javascript" src="./js/gameObject.js?v=1"></script>
        <script type="text/javascript" src="./js/gameObjectMgr.js?v=1"></script>
        <script type="text/javascript" src="./js/collisions.js?v=1"></script>
        <script type="text/javascript" src="./js/rigidBody.js?v=1"></script>
        
                
        <!-- ################ Game, Menu & Levels ################ -->
        <script type="text/javascript" src="./js/MagneticScrapyard1000.js"></script>
        <script type="text/javascript" src="./js/Menu.js"></script>
        <script type="text/javascript" src="./js/ResultScreen.js"></script>

        <script type="text/javascript" src="./js/GameplayCommon.js"></script>
        
        <script type="text/javascript" src="./js/GameplayLevel4.js?v=1"></script>
        <script type="text/javascript" src="./js/WorkerLevel4.js?v=1"></script>
        
        <script type="text/javascript" src="./js/GameplayLevel5.js?v=1"></script>
        <script type="text/javascript" src="./js/WorkerLevel5.js?v=1"></script>
        
        <script type="text/javascript" src="./js/GameplayLevel6.js?v=1"></script>
        <script type="text/javascript" src="./js/WorkerLevel6.js?v=1"></script>

        <script type="text/javascript" src="./js/GameplayLevel7.js?v=1"></script>
        <script type="text/javascript" src="./js/WorkerLevel7.js?v=1"></script>

        <script type="text/javascript" src="./js/GameplayLevel8.js?v=1"></script>
        <script type="text/javascript" src="./js/WorkerLevel8.js?v=1"></script>

        <script type="text/javascript" src="./js/GameplayLevel9.js?v=1"></script>
        <script type="text/javascript" src="./js/WorkerLevel9.js?v=1"></script>
        
        <!-- ################ Particle-Spray Colors ################ -->
        <script type="text/javascript" src="./js/particleColors_pcbLogoHQ.js?v=1"></script>
        <script type="text/javascript" src="./js/particleColors_atomicLogoHQ.js?v=1"></script>
                
    </head>
    
            
    <body>
        
        <script>
            window.addEventListener('resize', resize);
            
            // The PixiJS application instance
            let app = new PIXI.Application({
                resizeTo: window, // Auto fill the screen
                autoDensity: true, // Handles high DPI screens
                backgroundColor: 0x282e38
            });
            
            // Add application canvas to body
            document.body.appendChild(app.view);

            // https://github.com/kittykatattack/scaleToWindow
            var newStyle = document.createElement("style");
            var style = "* {padding: 0; margin: 0}";
            newStyle.appendChild(document.createTextNode(style));
            document.head.appendChild(newStyle);var newStyle = document.createElement("style");
            var style = "* {padding: 0; margin: 0}";
            newStyle.appendChild(document.createTextNode(style));
            document.head.appendChild(newStyle);
            
            let windowScale = AppUtils.scaleToWindow( app.renderer.view );		

            app.stage.position.set(0, 0);
            app.stage.width  = app.screen.width;
            app.stage.height = app.screen.height;
            app.stage.filterArea = app.renderer.screen;
            

            let background_music = PIXI.sound.Sound.from({
                url: '../assets/music/Deep Space Beta.mp3',
                autoPlay: true,
                loop: true,
                volume: 0.3,
                complete: function() {
                    console.log('Sound finished');
                }
            });
            { // 1st playback volume hack
                background_music.volume = 0.0001; 
                //background_music.play();
                //background_music.stop();
            }
            background_music.volume = 0.3;



            let sound_meta_obj = {
                muted: false,
                background_music: background_music,
                //background_music_alias: 'background-music-alias',
                main_thrust_alias: 'thrust-sfx-alias',
                small_thrust_alias: 'small-thrust-sfx-alias',
                rock_destroy_alias: 'rock-destroy-sfx-alias',
                player_collide_sfx_alias: 'stone-scratch-sfx-alias',
                object_collide_sfx_alias: 'stone-scratch-2-sfx-alias',
            };
            
            // sound is an instance of SoundLibrary
            
            //PIXI.sound.add( sound_meta_obj.background_music_alias, sound_meta_obj.background_music );
            
            PIXI.sound.add( sound_meta_obj.main_thrust_alias, '../assets/music/thrust.mp3' );
            { // 1st playback volume hack
                PIXI.sound.volume( sound_meta_obj.main_thrust_alias, 0.0001 ); 
                PIXI.sound.play( sound_meta_obj.main_thrust_alias );
                PIXI.sound.stop( sound_meta_obj.main_thrust_alias );
            }
            PIXI.sound.volume( sound_meta_obj.main_thrust_alias, 0.4 );
            

            PIXI.sound.add( sound_meta_obj.small_thrust_alias, '../assets/music/thrust.mp3' );
            { // 1st playback volume hack
                PIXI.sound.volume( sound_meta_obj.small_thrust_alias, 0.0001 );
                PIXI.sound.play( sound_meta_obj.small_thrust_alias );
                PIXI.sound.stop( sound_meta_obj.small_thrust_alias );
            }
            PIXI.sound.volume( sound_meta_obj.small_thrust_alias, 0.25 );
            
            PIXI.sound.add( sound_meta_obj.rock_destroy_alias, '../assets/music/rock-destroy-6409.mp3' );
            { // 1st playback volume hack
                PIXI.sound.volume( sound_meta_obj.rock_destroy_alias, 0.0001 );
                PIXI.sound.play( sound_meta_obj.rock_destroy_alias );
                PIXI.sound.stop( sound_meta_obj.rock_destroy_alias );
            }
            PIXI.sound.volume( sound_meta_obj.rock_destroy_alias, 0.5 );
            
            PIXI.sound.add( sound_meta_obj.player_collide_sfx_alias, '../assets/music/aluminum-cans-31112.mp3' );
            { // 1st playback volume hack
                PIXI.sound.volume( sound_meta_obj.player_collide_sfx_alias, 0.0001 );
                PIXI.sound.play( sound_meta_obj.player_collide_sfx_alias );
                PIXI.sound.stop( sound_meta_obj.player_collide_sfx_alias );
            }
            PIXI.sound.volume( sound_meta_obj.player_collide_sfx_alias, 0.5 );

            PIXI.sound.add( sound_meta_obj.object_collide_sfx_alias, '../assets/music/stones-falling-6375.mp3' );
            { // 1st playback volume hack
                PIXI.sound.volume( sound_meta_obj.object_collide_sfx_alias, 0.0001 );
                PIXI.sound.play( sound_meta_obj.object_collide_sfx_alias );
                PIXI.sound.stop( sound_meta_obj.object_collide_sfx_alias );
            }
            PIXI.sound.volume( sound_meta_obj.object_collide_sfx_alias, 0.15 );
            

            let magneticScrapyard1000 = new MagneticScrapyard1000(app, window, sound_meta_obj);
            
            
            // Resize function window
            function resize() {
                // windowScale = AppUtils.scaleToWindow( app.renderer.view );
                //console.log( windowScale );
                console.log( `resize event:` ); 
                console.log( `    window.innerWidth: ${window.innerWidth} x ${window.innerHeight}` );

                // NO!!! don't touch the sizes anymore!
                // app.stage.width  = app.screen.width;
                // app.stage.height = app.screen.height;
                // app.stage.filterArea = app.renderer.screen;
                
                //magneticScrapyard1000.onResize( window.innerWidth, window.innerHeight);
                // app.stage.position.x = app.renderer.screen.width/2;
                // app.stage.position.y = app.renderer.screen.height/2;                
                // app.stage.width  	  = app.renderer.screen.width;
		        // app.stage.height 	  = app.renderer.screen.height;                 
            }
            
        </script>
    </body>
</html>